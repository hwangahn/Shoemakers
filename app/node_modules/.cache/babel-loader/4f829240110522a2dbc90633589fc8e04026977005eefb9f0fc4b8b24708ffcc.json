{"ast":null,"code":"/**\n * Module dependencies.\n */\nvar pause = require('pause'),\n  util = require('util'),\n  Strategy = require('passport-strategy');\n\n/**\n * `SessionStrategy` constructor.\n *\n * @api public\n */\nfunction SessionStrategy(options, deserializeUser) {\n  if (typeof options == 'function') {\n    deserializeUser = options;\n    options = undefined;\n  }\n  options = options || {};\n  Strategy.call(this);\n  this.name = 'session';\n  this._key = options.key || 'passport';\n  this._deserializeUser = deserializeUser;\n}\n\n/**\n * Inherit from `Strategy`.\n */\nutil.inherits(SessionStrategy, Strategy);\n\n/**\n * Authenticate request based on the current session state.\n *\n * The session authentication strategy uses the session to restore any login\n * state across requests.  If a login session has been established, `req.user`\n * will be populated with the current user.\n *\n * This strategy is registered automatically by Passport.\n *\n * @param {Object} req\n * @param {Object} options\n * @api protected\n */\nSessionStrategy.prototype.authenticate = function (req, options) {\n  if (!req.session) {\n    return this.error(new Error('Login sessions require session support. Did you forget to use `express-session` middleware?'));\n  }\n  options = options || {};\n  var self = this,\n    su;\n  if (req.session[this._key]) {\n    su = req.session[this._key].user;\n  }\n  if (su || su === 0) {\n    // NOTE: Stream pausing is desirable in the case where later middleware is\n    //       listening for events emitted from request.  For discussion on the\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\n\n    var paused = options.pauseStream ? pause(req) : null;\n    this._deserializeUser(su, req, function (err, user) {\n      if (err) {\n        return self.error(err);\n      }\n      if (!user) {\n        delete req.session[self._key].user;\n      } else {\n        var property = req._userProperty || 'user';\n        req[property] = user;\n      }\n      self.pass();\n      if (paused) {\n        paused.resume();\n      }\n    });\n  } else {\n    self.pass();\n  }\n};\n\n/**\n * Expose `SessionStrategy`.\n */\nmodule.exports = SessionStrategy;","map":{"version":3,"names":["pause","require","util","Strategy","SessionStrategy","options","deserializeUser","undefined","call","name","_key","key","_deserializeUser","inherits","prototype","authenticate","req","session","error","Error","self","su","user","paused","pauseStream","err","property","_userProperty","pass","resume","module","exports"],"sources":["C:/Users/hoang/OneDrive/Documents/test/node_modules/passport/lib/strategies/session.js"],"sourcesContent":["/**\n * Module dependencies.\n */\nvar pause = require('pause')\n  , util = require('util')\n  , Strategy = require('passport-strategy');\n\n\n/**\n * `SessionStrategy` constructor.\n *\n * @api public\n */\nfunction SessionStrategy(options, deserializeUser) {\n  if (typeof options == 'function') {\n    deserializeUser = options;\n    options = undefined;\n  }\n  options = options || {};\n  \n  Strategy.call(this);\n  this.name = 'session';\n  this._key = options.key || 'passport';\n  this._deserializeUser = deserializeUser;\n}\n\n/**\n * Inherit from `Strategy`.\n */\nutil.inherits(SessionStrategy, Strategy);\n\n/**\n * Authenticate request based on the current session state.\n *\n * The session authentication strategy uses the session to restore any login\n * state across requests.  If a login session has been established, `req.user`\n * will be populated with the current user.\n *\n * This strategy is registered automatically by Passport.\n *\n * @param {Object} req\n * @param {Object} options\n * @api protected\n */\nSessionStrategy.prototype.authenticate = function(req, options) {\n  if (!req.session) { return this.error(new Error('Login sessions require session support. Did you forget to use `express-session` middleware?')); }\n  options = options || {};\n\n  var self = this, \n      su;\n  if (req.session[this._key]) {\n    su = req.session[this._key].user;\n  }\n\n  if (su || su === 0) {\n    // NOTE: Stream pausing is desirable in the case where later middleware is\n    //       listening for events emitted from request.  For discussion on the\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\n    \n    var paused = options.pauseStream ? pause(req) : null;\n    this._deserializeUser(su, req, function(err, user) {\n      if (err) { return self.error(err); }\n      if (!user) {\n        delete req.session[self._key].user;\n      } else {\n        var property = req._userProperty || 'user';\n        req[property] = user;\n      }\n      self.pass();\n      if (paused) {\n        paused.resume();\n      }\n    });\n  } else {\n    self.pass();\n  }\n};\n\n\n/**\n * Expose `SessionStrategy`.\n */\nmodule.exports = SessionStrategy;\n"],"mappings":"AAAA;AACA;AACA;AACA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;EACxBC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;EACtBE,QAAQ,GAAGF,OAAO,CAAC,mBAAmB,CAAC;;AAG3C;AACA;AACA;AACA;AACA;AACA,SAASG,eAAeA,CAACC,OAAO,EAAEC,eAAe,EAAE;EACjD,IAAI,OAAOD,OAAO,IAAI,UAAU,EAAE;IAChCC,eAAe,GAAGD,OAAO;IACzBA,OAAO,GAAGE,SAAS;EACrB;EACAF,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;EAEvBF,QAAQ,CAACK,IAAI,CAAC,IAAI,CAAC;EACnB,IAAI,CAACC,IAAI,GAAG,SAAS;EACrB,IAAI,CAACC,IAAI,GAAGL,OAAO,CAACM,GAAG,IAAI,UAAU;EACrC,IAAI,CAACC,gBAAgB,GAAGN,eAAe;AACzC;;AAEA;AACA;AACA;AACAJ,IAAI,CAACW,QAAQ,CAACT,eAAe,EAAED,QAAQ,CAAC;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,eAAe,CAACU,SAAS,CAACC,YAAY,GAAG,UAASC,GAAG,EAAEX,OAAO,EAAE;EAC9D,IAAI,CAACW,GAAG,CAACC,OAAO,EAAE;IAAE,OAAO,IAAI,CAACC,KAAK,CAAC,IAAIC,KAAK,CAAC,6FAA6F,CAAC,CAAC;EAAE;EACjJd,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;EAEvB,IAAIe,IAAI,GAAG,IAAI;IACXC,EAAE;EACN,IAAIL,GAAG,CAACC,OAAO,CAAC,IAAI,CAACP,IAAI,CAAC,EAAE;IAC1BW,EAAE,GAAGL,GAAG,CAACC,OAAO,CAAC,IAAI,CAACP,IAAI,CAAC,CAACY,IAAI;EAClC;EAEA,IAAID,EAAE,IAAIA,EAAE,KAAK,CAAC,EAAE;IAClB;IACA;IACA;;IAEA,IAAIE,MAAM,GAAGlB,OAAO,CAACmB,WAAW,GAAGxB,KAAK,CAACgB,GAAG,CAAC,GAAG,IAAI;IACpD,IAAI,CAACJ,gBAAgB,CAACS,EAAE,EAAEL,GAAG,EAAE,UAASS,GAAG,EAAEH,IAAI,EAAE;MACjD,IAAIG,GAAG,EAAE;QAAE,OAAOL,IAAI,CAACF,KAAK,CAACO,GAAG,CAAC;MAAE;MACnC,IAAI,CAACH,IAAI,EAAE;QACT,OAAON,GAAG,CAACC,OAAO,CAACG,IAAI,CAACV,IAAI,CAAC,CAACY,IAAI;MACpC,CAAC,MAAM;QACL,IAAII,QAAQ,GAAGV,GAAG,CAACW,aAAa,IAAI,MAAM;QAC1CX,GAAG,CAACU,QAAQ,CAAC,GAAGJ,IAAI;MACtB;MACAF,IAAI,CAACQ,IAAI,EAAE;MACX,IAAIL,MAAM,EAAE;QACVA,MAAM,CAACM,MAAM,EAAE;MACjB;IACF,CAAC,CAAC;EACJ,CAAC,MAAM;IACLT,IAAI,CAACQ,IAAI,EAAE;EACb;AACF,CAAC;;AAGD;AACA;AACA;AACAE,MAAM,CAACC,OAAO,GAAG3B,eAAe"},"metadata":{},"sourceType":"script","externalDependencies":[]}